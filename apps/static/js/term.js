(function(){function r(){this._events=this._events||{}}function w(){r.call(this)}function c(a,b,d){var e=this;if(!(this instanceof c))return new c(a,b,d);r.call(this);"number"===typeof a&&(a={cols:a,rows:b,handler:d});a=a||{};B(C(c.defaults),function(b){null==a[b]&&(a[b]=c.options[b],c[b]!==c.defaults[b]&&(a[b]=c[b]));e[b]=a[b]});8===a.colors.length?a.colors=a.colors.concat(c._colors.slice(8)):16===a.colors.length?a.colors=a.colors.concat(c._colors.slice(16)):10===a.colors.length?a.colors=a.colors.slice(0,
-2).concat(c._colors.slice(8,-2),a.colors.slice(-2)):18===a.colors.length&&(a.colors=a.colors.slice(0,-2).concat(c._colors.slice(16,-2),a.colors.slice(-2)));this.colors=a.colors;this.options=a;this.parent=a.body||a.parent||(x?x.getElementsByTagName("body")[0]:null);this.cols=a.cols||a.geometry[0];this.rows=a.rows||a.geometry[1];this.setRawMode;this.isRaw=this.isTTY=!0;this.columns=this.cols;this.rows=this.rows;if(a.handler)this.on("data",a.handler);this.cursorState=this.y=this.x=this.ydisp=this.ybase=
0;this.cursorHidden=!1;this.convertEol;this.state=0;this.queue="";this.scrollTop=0;this.scrollBottom=this.rows-1;this.wraparoundMode=this.insertMode=this.originMode=this.applicationCursor=this.applicationKeypad=!1;this.normal=null;this.searchMode=this.visualMode=this.selectMode=this.prefixMode=!1;this.searchDown;this.entry="";this.entryPrefix="Search: ";this._real;this._selected;this._textarea;this.gcharset=this.charset=null;this.glevel=0;this.charsets=[null];this.decLocator;this.x10Mouse;this.vt200Mouse;
this.vt300Mouse;this.normalMouse;this.mouseEvents;this.sendFocus;this.utfMouse;this.sgrMouse;this.urxvtMouse;this.element;this.children;this.refreshStart;this.refreshEnd;this.savedX;this.savedY;this.savedCols;this.writable=this.readable=!0;this.curAttr=this.defAttr=131840;this.params=[];this.currentParam=0;this.postfix=this.prefix="";this.lines=[];for(b=this.rows;b--;)this.lines.push(this.blankLine());this.tabs;this.setupStops()}function m(a,b,d,e){a.addEventListener(b,d,e||!1)}function y(a,b,d,e){a.removeEventListener(b,
d,e||!1)}function p(a){a.preventDefault&&a.preventDefault();a.returnValue=!1;a.stopPropagation&&a.stopPropagation();a.cancelBubble=!0;return!1}function z(a,b){function d(){this.constructor=a}d.prototype=b.prototype;a.prototype=new d}function G(a){var b=a.getElementsByTagName("body")[0],d=a.createElement("div");d.className="terminal";var e=a.createElement("div");a=a.createElement("span");a.innerHTML="hello world";e.appendChild(a);d.appendChild(e);b.appendChild(d);e=a.scrollWidth;a.style.fontWeight=
"bold";a=a.scrollWidth;b.removeChild(d);return e!==a}function A(a){a=a.charCodeAt(0);return 4352>a?!1:4352<=a&&4447>=a||4515<=a&&4519>=a||4602<=a&&4607>=a||9001<=a&&9002>=a||11904<=a&&11929>=a||11931<=a&&12019>=a||12032<=a&&12245>=a||12272<=a&&12283>=a||12288<=a&&12350>=a||12353<=a&&12438>=a||12441<=a&&12543>=a||12549<=a&&12589>=a||12593<=a&&12686>=a||12688<=a&&12730>=a||12736<=a&&12771>=a||12784<=a&&12830>=a||12832<=a&&12871>=a||12880<=a&&13054>=a||13056<=a&&19903>=a||19968<=a&&42124>=a||42128<=
a&&42182>=a||43360<=a&&43388>=a||44032<=a&&55203>=a||55216<=a&&55238>=a||55243<=a&&55291>=a||63744<=a&&64255>=a||65040<=a&&65049>=a||65072<=a&&65106>=a||65108<=a&&65126>=a||65128<=a&&65131>=a||65281<=a&&65376>=a||65504<=a&&65510>=a}function v(a,b,d){var e=a<<16|b<<8|d;if(null!=v._cache[e])return v._cache[e];for(var k=Infinity,g=-1,f=0,h,n,q;f<c.vcolors.length;f++){h=c.vcolors[f];n=h[0];q=h[1];h=h[2];n=v.distance(a,b,d,n,q,h);if(0===n){g=f;break}n<k&&(k=n,g=f)}return v._cache[e]=g}function B(a,b,d){if(a.forEach)return a.forEach(b,
d);for(var e=0;e<a.length;e++)b.call(d,a[e],e,a)}function C(a){if(Object.keys)return Object.keys(a);var b,d=[];for(b in a)Object.prototype.hasOwnProperty.call(a,b)&&d.push(b);return d}var x=this.document;r.prototype.addListener=function(a,b){this._events[a]=this._events[a]||[];this._events[a].push(b)};r.prototype.on=r.prototype.addListener;r.prototype.removeListener=function(a,b){if(this._events[a])for(var d=this._events[a],e=d.length;e--;)if(d[e]===b||d[e].listener===b){d.splice(e,1);break}};r.prototype.off=
r.prototype.removeListener;r.prototype.removeAllListeners=function(a){this._events[a]&&delete this._events[a]};r.prototype.once=function(a,b){function d(){var e=Array.prototype.slice.call(arguments);this.removeListener(a,d);return b.apply(this,e)}d.listener=b;return this.on(a,d)};r.prototype.emit=function(a){if(this._events[a])for(var b=Array.prototype.slice.call(arguments,1),d=this._events[a],e=d.length,c=0;c<e;c++)d[c].apply(this,b)};r.prototype.listeners=function(a){return this._events[a]=this._events[a]||
[]};z(w,r);w.prototype.pipe=function(a,b){function d(){e.removeListener("data",c);e.removeListener("error",g);e.removeListener("end",f);a.removeListener("error",g);a.removeListener("close",d)}var e=this,c,g,f;e.on("data",c=function(b){a.write(b)});e.on("error",g=function(a){d();if(!this.listeners("error").length)throw a;});e.on("end",f=function(){a.end();d()});a.on("error",g);a.on("close",d);a.emit("pipe",e);return a};var D={type:"udk"};z(c,w);c.tangoColors="#2e3436 #cc0000 #4e9a06 #c4a000 #3465a4 #75507b #06989a #d3d7cf #555753 #ef2929 #8ae234 #fce94f #729fcf #ad7fa8 #34e2e2 #eeeeec".split(" ");
c.xtermColors="#000000 #cd0000 #00cd00 #cdcd00 #0000ee #cd00cd #00cdcd #e5e5e5 #7f7f7f #ff0000 #00ff00 #ffff00 #5c5cff #ff00ff #00ffff #ffffff".split(" ");c.colors=function(){function a(a,e,c){d.push("#"+b(a)+b(e)+b(c))}function b(a){a=a.toString(16);return 2>a.length?"0"+a:a}var d=c.tangoColors.slice(),e=[0,95,135,175,215,255],k;for(k=0;216>k;k++)a(e[k/36%6|0],e[k/6%6|0],e[k%6]);for(k=0;24>k;k++)e=8+10*k,a(e,e,e);return d}();c.colors[256]="#000000";c.colors[257]="#f0f0f0";c._colors=c.colors.slice();
c.vcolors=function(){for(var a=[],b=c.colors,d=0,e;256>d;d++)e=parseInt(b[d].substring(1),16),a.push([e>>16&255,e>>8&255,e&255]);return a}();c.defaults={colors:c.colors,convertEol:!1,termName:"xterm",geometry:[80,24],cursorBlink:!0,visualBell:!1,popOnBell:!1,scrollback:1E3,screenKeys:!1,debug:!1,useStyle:!1};c.options={};B(C(c.defaults),function(a){c[a]=c.defaults[a];c.options[a]=c.defaults[a]});c.focus=null;c.prototype.focus=function(){this._textarea&&this._textarea.focus();c.focus!==this&&(c.focus&&
c.focus.blur(),this.sendFocus&&this.send("\u001b[I"),this.showCursor(),c.focus=this)};c.prototype.blur=function(){c.focus===this&&(this.cursorState=0,this.refresh(this.y,this.y),this.sendFocus&&this.send("\u001b[O"),c.focus=null)};c.prototype.initGlobal=function(){var a=this.document;c._boundDocs=c._boundDocs||[];a:{var b=c._boundDocs;for(var d=b.length;d--;)if(b[d]===a){b=d;break a}b=-1}~b||(c._boundDocs.push(a),c.bindPaste(a),c.bindKeys(a),c.bindCopy(a),this.useStyle&&c.insertStyle(a,this.colors[256],
this.colors[257]))};c.bindPaste=function(a){m(a.defaultView,"paste",function(a){var b=c.focus;if(b&&!b._textarea)return a.clipboardData?b.send(a.clipboardData.getData("text/plain")):b.context.clipboardData&&b.send(b.context.clipboardData.getData("Text")),b.element.contentEditable="inherit",p(a)})};c.bindKeys=function(a){m(a,"keydown",function(a){if(c.focus){var b=a.target||a.srcElement;if(b&&(b===c.focus.element||b===c.focus.context||b===c.focus.document||b===c.focus.body||b===c.focus._textarea||
b===c.focus.parent))return c.focus.keyDown(a)}},!0);m(a,"keypress",function(a){if(c.focus){var b=a.target||a.srcElement;if(b&&(b===c.focus.element||b===c.focus.context||b===c.focus.document||b===c.focus.body||b===c.focus._textarea||b===c.focus.parent))return c.focus.keyPress(a)}},!0);m(a,"mousedown",function(a){if(c.focus&&(a=a.target||a.srcElement)&&a.parentNode&&a.parentNode.parentNode){do if(a===c.focus.element)return;while(a=a.parentNode);c.focus.blur()}})};c.bindCopy=function(a){m(a.defaultView,
"copy",function(a){var b=c.focus;if(b&&b._selected){a=b.getCopyTextarea();var e=b.grabText(b._selected.x1,b._selected.x2,b._selected.y1,b._selected.y2);b.emit("copy",e);a.focus();a.textContent=e;a.value=e;a.setSelectionRange(0,e.length);u(function(){b.element.focus();b.focus()},1)}})};c.prototype.getTextarea=function(a){var b=this,d=a.createElement("textarea");d.style.position="absolute";d.style.left="-32000px";d.style.top="-32000px";d.style.width="100em";d.style.height="2em";d.style.padding="0";
d.style.opacity="0";d.style.color="inherit";d.style.font="inherit";d.style.textIndent="-1em";d.style.backgroundColor="transparent";d.style.borderStyle="none";d.style.outlineStyle="none";d.autocapitalize="none";d.autocorrect="off";var e,k=function(a){a.timeStamp&&a.timeStamp===e||(e=a.timeStamp,a=d.textContent||d.value,"undefined"!==typeof b.select.startPos&&(b.select={},b.clearSelectedText(),b.refresh(0,b.rows-1)),b.compositionStatus||(d.value="",d.textContent="",b.send(a)))};m(d,"compositionstart",
function(){d.style.opacity="1.0";d.style.textIndent="0";b.compositionStatus=!0});m(d,"compositionend",function(a){d.style.opacity="0.0";d.style.textIndent="-1em";b.compositionStatus=!1;u(function(){k(a)},1)});m(d,"keydown",function(){});m(d,"input",k);c.isAndroid&&m(d,"change",function(){var a=d.textContent||d.value;d.value="";d.textContent="";b.send(a+"\r")});return d};c.insertStyle=function(a,b,d){var e=a.getElementById("term-style");if(!e){var c=a.getElementsByTagName("head")[0];c&&(e=a.createElement("style"),
e.id="term-style",e.innerHTML=".applications {\n  float: left;\n  border: "+b+' solid 5px;\n  font-family: "DejaVu Sans Mono", "Liberation Mono", monospace;\n  font-size: 11px;\n  color: '+d+";\n  background: "+b+";\n}\n\n.applications-cursor {\n  color: "+b+";\n  background: "+d+";\n}\n",c.insertBefore(e,c.firstChild))}};c.prototype.open=function(a){var b=this,d=0;this.parent=a||this.parent;if(!this.parent)throw Error("Terminal requires a parent element.");this.context=this.parent.ownerDocument.defaultView;
this.document=this.parent.ownerDocument;this.body=this.document.getElementsByTagName("body")[0];this.context.navigator&&this.context.navigator.userAgent&&(this.isMac=!!~this.context.navigator.userAgent.indexOf("Mac"),this.isIpad=!!~this.context.navigator.userAgent.indexOf("iPad"),this.isIphone=!!~this.context.navigator.userAgent.indexOf("iPhone"),this.isAndroid=!!~this.context.navigator.userAgent.indexOf("Android"),this.isMobile=this.isIpad||this.isIphone||this.isAndroid,this.isMSIE=!!~this.context.navigator.userAgent.indexOf("MSIE"));
this.element=this.document.createElement("div");this.element.className="terminal";this.element.style.outline="none";this.element.setAttribute("tabindex",0);this.element.setAttribute("spellcheck","false");this.element.style.backgroundColor=this.colors[256];this.element.style.color=this.colors[257];for(this.children=[];d<this.rows;d++)a=this.document.createElement("div"),this.element.appendChild(a),this.children.push(a);this._textarea=this.getTextarea(this.document);this.element.appendChild(this._textarea);
this.parent.appendChild(this.element);this.select={};this.refresh(0,this.rows-1);var e=function(){var a=b.select.startPos,d=b.select.endPos;if(d.y<a.y||a.y==d.y&&d.x<a.x){var e=a;a=d;d=e}if(2===b.select.clicks){for(e=function(a){a=a.charCodeAt(0);return 47>=a||58<=a&&64>=a||91<=a&&96>a||123<=a&&127>=a};0<a.x&&!e(b.lines[a.y][a.x-1][1]);)a.x--;for(;d.x<b.cols&&!e(b.lines[d.y][d.x][1]);)d.x++}else 3===b.select.clicks&&(a.x=0,d.y++,d.x=0);a.x===d.x&&a.y===d.y?b.clearSelectedText():(e=d.x,d=d.y,e--,0>
e&&(d--,e=b.cols-1),b.selectText(a.x,e,a.y,d))},k=function(){var a=b._textarea;if(a){if(b.select.startPos.x===b.select.endPos.x&&b.select.startPos.y===b.select.endPos.y)a.value="";else{var d=b.select.endPos.x,e=b.select.endPos.y;d--;0>d&&(e--,d=b.cols-1);d=b.grabText(b.select.startPos.x,d,b.select.startPos.y,e);a.value=d}a.select()}};m(this.element,"mousedown",function(a){if(2===a.button){var d=b.element.getBoundingClientRect(),c=a.pageY-d.top+b.element.offsetTop;b._textarea.style.left=a.pageX-d.left+
b.element.offsetLeft+"px";b._textarea.style.top=c+"px"}else 0==a.button&&(navigator.userAgent.indexOf("Trident")?(b.select.timer?(b.select.clicks++,clearTimeout(b.select.timer),b.select.timer=null):b.select.clicks=1,b.select.timer=u(function(){b.select.timer=null},600)):b.select.clicks=a.detail,a.shiftKey||(b.clearSelectedText(),b.select.startPos=b.getCoords(a),b.select.startPos.y+=b.ydisp),b.select.endPos=b.getCoords(a),b.select.endPos.y+=b.ydisp,e(),k(),b.refresh(0,b.rows-1),b.select.selecting=
!0)});m(this.element,"mousemove",function(a){b.select.selecting&&(b.select.endPos=b.getCoords(a),b.select.endPos.y+=b.ydisp,e(),b.refresh(0,b.rows-1))});m(x,"mouseup",function(a){if(2===a.button){var d=b.element.getBoundingClientRect(),e=a.pageY-d.top+b.element.offsetTop;b._textarea.style.left=a.pageX-d.left+b.element.offsetLeft-1+"px";b._textarea.style.top=e-1+"px"}else b.select.selecting&&(b.select.selecting=!1,k())});"useEvents"in this.options&&!this.options.useEvents||this.initGlobal();"useFocus"in
this.options&&!this.options.useFocus||(this.focus(),this.startBlink(),m(this.element,"focus",function(){b.focus()}),m(this.element,"mousedown",function(){b.focus()}),m(this.element,"mousedown",function(a){a=null!=a.button?+a.button:null!=a.which?a.which-1:null;b.isMSIE&&(a=1===a?0:4===a?1:a);2===a&&(b.element.contentEditable="true",u(function(){b.element.contentEditable="inherit"},1))},!0));"useMouse"in this.options&&!this.options.useMouse||this.bindMouse();"useFocus"in this.options&&!this.options.useFocus||
u(function(){b.element.focus();b.focus()},100);null==c.brokenBold&&(c.brokenBold=G(this.document));this.emit("open")};c.prototype.setRawMode=function(a){this.isRaw=!!a};c.prototype.getCoords=function(a){if(null!=a.pageX){var b=a.pageX;a=a.pageY;var d=this.element;b-=d.clientLeft;for(a-=d.clientTop;d&&d!==this.document.documentElement;)b-=d.offsetLeft,a-=d.offsetTop,d="offsetParent"in d?d.offsetParent:d.parentNode;d=this.element.clientWidth;b=Math.floor(b/d*this.cols);a=Math.floor(a/this.element.clientHeight*
this.rows);0>b&&(b=0);b>this.cols&&(b=this.cols);0>a&&(a=0);a>this.rows&&(a=this.rows);return{x:b,y:a}}};c.prototype.bindMouse=function(){function a(a){switch(a.type){case "mousedown":var b=null!=a.button?+a.button:null!=a.which?a.which-1:null;f.isMSIE&&(b=1===b?0:4===b?1:b);break;case "mouseup":b=3;break;case "DOMMouseScroll":b=0>a.detail?64:65;break;case "mousewheel":b=0<a.wheelDeltaY?64:65}var d=a.shiftKey?4:0;var k=a.metaKey?8:0;var g=a.ctrlKey?16:0;d=d|k|g;f.vt200Mouse?d&=g:f.normalMouse||(d=
0);b=32+(d<<2)+b;if(g=c(a))switch(e(b,g),a.type){case "mousedown":h=b;break;case "mouseup":h=32}}function b(a){var b=h;(a=c(a))&&e(b+32,a)}function d(a,b){if(f.utfMouse){if(2047===b)return a.push(0);127>b?a.push(b):(2047<b&&(b=2047),a.push(192|b>>6),a.push(128|b&63))}else{if(255===b)return a.push(0);127<b&&(b=127);a.push(b)}}function e(a,b){if(f.vt300Mouse){a&=3;b.x-=32;b.y-=32;var e="\u001b[24";if(0===a)e+="1";else if(1===a)e+="3";else if(2===a)e+="5";else{if(3===a)return;e+="0"}e+="~["+b.x+","+
b.y+"]\r";f.send(e)}else f.decLocator?(a&=3,b.x-=32,b.y-=32,0===a?a=2:1===a?a=4:2===a?a=6:3===a&&(a=3),f.send("\u001b["+a+";"+(3===a?4:0)+";"+b.y+";"+b.x+";"+(b.page||0)+"&w")):f.urxvtMouse?(b.x-=32,b.y-=32,b.x++,b.y++,f.send("\u001b["+a+";"+b.x+";"+b.y+"M")):f.sgrMouse?(b.x-=32,b.y-=32,f.send("\u001b[<"+(3===(a&3)?a&-4:a)+";"+b.x+";"+b.y+(3===(a&3)?"m":"M"))):(e=[],d(e,a),d(e,b.x),d(e,b.y),f.send("\u001b[M"+t.fromCharCode.apply(t,e)))}function c(a){var b;if(null!=a.pageX){var d=a.pageX;var e=a.pageY;
for(b=f.element;b&&b!==f.document.documentElement;)d-=b.offsetLeft,e-=b.offsetTop,b="offsetParent"in b?b.offsetParent:b.parentNode;b=f.element.clientWidth;var c=f.element.clientHeight;d=Math.round(d/b*f.cols);e=Math.round(e/c*f.rows);0>d&&(d=0);d>f.cols&&(d=f.cols);0>e&&(e=0);e>f.rows&&(e=f.rows);return{x:d+32,y:e+32,type:a.type===n?"mousewheel":a.type}}}var g=this.element,f=this,h=32,n="onmousewheel"in this.context?"mousewheel":"DOMMouseScroll";m(g,"mousedown",function(d){if(f.mouseEvents)return a(d),
f.focus(),f.normalMouse&&m(f.document,"mousemove",b),f.x10Mouse||m(f.document,"mouseup",function H(d){a(d);f.normalMouse&&y(f.document,"mousemove",b);y(f.document,"mouseup",H);return p(d)}),p(d)});m(g,n,function(b){if(f.mouseEvents&&!(f.x10Mouse||f.vt300Mouse||f.decLocator))return a(b),p(b)});m(g,n,function(a){if(!f.mouseEvents&&!f.applicationKeypad)return"DOMMouseScroll"===a.type?f.scrollDisp(0>a.detail?-5:5):f.scrollDisp(0<a.wheelDeltaY?-5:5),p(a)})};c.prototype.close=c.prototype.destroySoon=c.prototype.destroy=
function(){this.destroyed||(this._blink&&(clearInterval(this._blink),delete this._blink),this.writable=this.readable=!1,this.destroyed=!0,this._events={},this.handler=function(){},this.write=function(){},this.end=function(){},this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.emit("end"),this.emit("close"),this.emit("finish"),this.emit("destroy"))};c.prototype.refresh=function(a,b){var d,e,k=this.element.clientWidth/this.cols,g=this.element.clientHeight/this.rows;if(b-
a>=this.rows/2){var f=c.focus==this;(e=this.element.parentNode)&&e.removeChild(this.element)}var h=this.cols;var n=a;b>=this.lines.length&&(this.log("`end` is too large. Most likely a bad CSR."),b=this.lines.length-1);for(;n<=b;n++){var q=n+this.ydisp;var E=this.lines[q];var l="";q=n!==this.y||!this.cursorState||this.ydisp!==this.ybase&&!this.selectMode||this.cursorHidden?-1:this.x;var m=this.defAttr;for(d=0;d<h;d++){var p=E[d][0];var r=E[d][1];d===q&&(p=-1);if(p!==m&&(m!==this.defAttr&&(l+="</span>"),
p!==this.defAttr))if(-1===p)l+='<span class="reverse-video applications-cursor">';else{l+='<span style="';m=p&511;var t=p>>9&511;var u=p>>18;u&1&&(c.brokenBold||(l+="font-weight:bold;"),8>t&&(t+=8));u&2&&(l+="text-decoration:underline;");u&4&&(u&2?(l=l.slice(0,-1),l+=" blink;"):l+="text-decoration:blink;");u&8&&(m=p>>9&511,t=p&511,u&1&&8>t&&(t+=8));u&16&&(l+="visibility:hidden;");256!==m&&(l+="background-color:"+this.colors[m]+";");257!==t&&(l+="color:"+this.colors[t]+";");l+='">'}switch(r){case "&":l+=
"&amp;";break;case "<":l+="&lt;";break;case ">":l+="&gt;";break;default:" ">=r?l+="&nbsp;":A(r)?(d++,l+='<span style="display:inline-block; width:'+2*k+"px; height:"+g+"px; line-height:"+g+'px;">'+r+"</span>"):l+=r}m=p}m!==this.defAttr&&(l+="</span>");this.children[n].innerHTML=l}e&&(e.appendChild(this.element),f&&this.focus());this._textarea&&(n=this.element.querySelector(".applications-cursor"))&&(h=n.offsetTop,this._textarea.style.left=n.offsetLeft+"px",this._textarea.style.top=h+"px")};c.prototype._cursorBlink=
function(){c.focus===this&&(this.cursorState^=1,this.refresh(this.y,this.y))};c.prototype.showCursor=function(){this.cursorState||(this.cursorState=1,this.refresh(this.y,this.y))};c.prototype.startBlink=function(){if(this.cursorBlink){var a=this;this._blinker=function(){a._cursorBlink()};this._blink=F(this._blinker,500)}};c.prototype.refreshBlink=function(){this.cursorBlink&&this._blink&&(clearInterval(this._blink),this._blink=F(this._blinker,500))};c.prototype.scroll=function(){++this.ybase===this.scrollback&&
(this.ybase=this.ybase/2|0,this.lines=this.lines.slice(-(this.ybase+this.rows)+1));this.ydisp=this.ybase;var a=this.ybase+this.rows-1;a-=this.rows-1-this.scrollBottom;a===this.lines.length?this.lines.push(this.blankLine()):this.lines.splice(a,0,this.blankLine());0!==this.scrollTop&&(0!==this.ybase&&(this.ybase--,this.ydisp=this.ybase),this.lines.splice(this.ybase+this.scrollTop,1));this.updateRange(this.scrollTop);this.updateRange(this.scrollBottom)};c.prototype.scrollDisp=function(a){this.ydisp+=
a;this.ydisp>this.ybase?this.ydisp=this.ybase:0>this.ydisp&&(this.ydisp=0);this.refresh(0,this.rows-1)};c.prototype.write=function(a){var b=a.length,d=0;this.refreshEnd=this.refreshStart=this.y;this.ybase!==this.ydisp&&(this.ydisp=this.ybase,this.maxRange());for(;d<b;d++,this.lch=e){var e=a[d];switch(this.state){case 0:switch(e){case "\u0007":this.bell();break;case "\n":case "\x0B":case "\f":this.convertEol&&(this.x=0);this.y++;this.y>this.scrollBottom&&(this.y--,this.scroll());break;case "\r":this.x=
0;break;case "\b":0<this.x&&this.x--;break;case "\t":this.x=this.nextStop();break;case "\u000e":this.setgLevel(1);break;case "\u000f":this.setgLevel(0);break;case "\u001b":this.state=1;break;default:if(" "<=e&&(this.charset&&this.charset[e]&&(e=this.charset[e]),this.x>=this.cols&&(this.x=0,this.y++,this.y>this.scrollBottom&&(this.y--,this.scroll())),this.lines[this.y+this.ybase][this.x]=[this.curAttr,e],this.x++,this.updateRange(this.y),A(e))){var k=this.y+this.ybase;2>this.cols||this.x>=this.cols?
this.lines[k][this.x-1]=[this.curAttr," "]:(this.lines[k][this.x]=[this.curAttr," "],this.x++)}}break;case 1:switch(e){case "[":this.params=[];this.currentParam=0;this.state=2;break;case "]":this.params=[];this.currentParam=0;this.state=3;break;case "P":this.params=[];this.currentParam=this.prefix="";this.state=5;break;case "_":this.state=6;break;case "^":this.state=6;break;case "c":this.reset();break;case "E":this.x=0;case "D":this.index();break;case "M":this.reverseIndex();break;case "%":this.setgLevel(0);
this.setgCharset(0,c.charsets.US);this.state=0;d++;break;case "(":case ")":case "*":case "+":case "-":case ".":switch(e){case "(":this.gcharset=0;break;case ")":this.gcharset=1;break;case "*":this.gcharset=2;break;case "+":this.gcharset=3;break;case "-":this.gcharset=1;break;case ".":this.gcharset=2}this.state=4;break;case "/":this.gcharset=3;this.state=4;d--;break;case "N":break;case "O":break;case "n":this.setgLevel(2);break;case "o":this.setgLevel(3);break;case "|":this.setgLevel(3);break;case "}":this.setgLevel(2);
break;case "~":this.setgLevel(1);break;case "7":this.saveCursor();this.state=0;break;case "8":this.restoreCursor();this.state=0;break;case "#":this.state=0;d++;break;case "H":this.tabSet();break;case "=":this.log("Serial port requested applications keypad.");this.applicationKeypad=!0;this.state=0;break;case ">":this.log("Switching back to normal keypad.");this.applicationKeypad=!1;this.state=0;break;default:this.state=0,this.error("Unknown ESC control: %s.",e)}break;case 4:switch(e){case "0":k=c.charsets.SCLD;
break;case "A":k=c.charsets.UK;break;case "B":k=c.charsets.US;break;case "4":k=c.charsets.Dutch;break;case "C":case "5":k=c.charsets.Finnish;break;case "R":k=c.charsets.French;break;case "Q":k=c.charsets.FrenchCanadian;break;case "K":k=c.charsets.German;break;case "Y":k=c.charsets.Italian;break;case "E":case "6":k=c.charsets.NorwegianDanish;break;case "Z":k=c.charsets.Spanish;break;case "H":case "7":k=c.charsets.Swedish;break;case "=":k=c.charsets.Swiss;break;case "/":k=c.charsets.ISOLatin;d++;break;
default:k=c.charsets.US}this.setgCharset(this.gcharset,k);this.gcharset=null;this.state=0;break;case 3:if("\u001b"===this.lch&&"\\"===e||"\u0007"===e){"\u001b"===this.lch&&("string"===typeof this.currentParam?this.currentParam=this.currentParam.slice(0,-1):"number"==typeof this.currentParam&&(this.currentParam=(this.currentParam- -21)/10));this.params.push(this.currentParam);switch(this.params[0]){case 0:case 1:case 2:this.params[1]&&(this.title=this.params[1],this.handleTitle(this.title))}this.params=
[];this.state=this.currentParam=0}else this.params.length?this.currentParam+=e:"0"<=e&&"9">=e?this.currentParam=10*this.currentParam+e.charCodeAt(0)-48:";"===e&&(this.params.push(this.currentParam),this.currentParam="");break;case 2:if("?"===e||">"===e||"!"===e){this.prefix=e;break}if("0"<=e&&"9">=e){this.currentParam=10*this.currentParam+e.charCodeAt(0)-48;break}if("$"===e||'"'===e||" "===e||"'"===e){this.postfix=e;break}this.params.push(this.currentParam);this.currentParam=0;if(";"===e)break;this.state=
0;switch(e){case "A":this.cursorUp(this.params);break;case "B":this.cursorDown(this.params);break;case "C":this.cursorForward(this.params);break;case "D":this.cursorBackward(this.params);break;case "H":this.cursorPos(this.params);break;case "J":this.eraseInDisplay(this.params);break;case "K":this.eraseInLine(this.params);break;case "m":this.prefix||this.charAttributes(this.params);break;case "n":this.prefix||this.deviceStatus(this.params);break;case "@":this.insertChars(this.params);break;case "E":this.cursorNextLine(this.params);
break;case "F":this.cursorPrecedingLine(this.params);break;case "G":this.cursorCharAbsolute(this.params);break;case "L":this.insertLines(this.params);break;case "M":this.deleteLines(this.params);break;case "P":this.deleteChars(this.params);break;case "X":this.eraseChars(this.params);break;case "`":this.charPosAbsolute(this.params);break;case "a":this.HPositionRelative(this.params);break;case "c":this.sendDeviceAttributes(this.params);break;case "d":this.linePosAbsolute(this.params);break;case "e":this.VPositionRelative(this.params);
break;case "f":this.HVPosition(this.params);break;case "h":this.setMode(this.params);break;case "l":this.resetMode(this.params);break;case "r":this.setScrollRegion(this.params);break;case "s":this.saveCursor(this.params);break;case "u":this.restoreCursor(this.params);break;case "I":this.cursorForwardTab(this.params);break;case "S":this.scrollUp(this.params);break;case "T":2>this.params.length&&!this.prefix&&this.scrollDown(this.params);break;case "Z":this.cursorBackwardTab(this.params);break;case "b":this.repeatPrecedingCharacter(this.params);
break;case "g":this.tabClear(this.params);break;case "p":switch(this.prefix){case "!":this.softReset(this.params)}break;default:this.error("Unknown CSI code: %s.",e)}this.postfix=this.prefix="";break;case 5:if("\u001b"===this.lch&&"\\"===e||"\u0007"===e)if("tmux;\u001b"===this.prefix&&"\u0007"===e)this.currentParam+=e;else{"\u001b"===this.lch&&("string"===typeof this.currentParam?this.currentParam=this.currentParam.slice(0,-1):"number"==typeof this.currentParam&&(this.currentParam=(this.currentParam-
-21)/10));this.params.push(this.currentParam);k=this.params[this.params.length-1];switch(this.prefix){case D:this.emit("udk",{clearAll:0===this.params[0],eraseBelow:1===this.params[0],lockKeys:0===this.params[1],dontLockKeys:1===this.params[1],keyList:(this.params[2]+"").split(";").map(function(a){a=a.split("/");return{keyCode:a[0],hexKeyValue:a[1]}})});break;case "$q":var g=0;switch(k){case '"q':k='0"q';g=1;break;case '"p':k='61;0"p';g=1;break;case "r":k=""+(this.scrollTop+1)+";"+(this.scrollBottom+
1)+"r";g=1;break;case "m":g=0;break;default:this.error("Unknown DCS Pt: %s.",k),g=0}this.send("\u001bP"+g+"$r"+k+"\u001b\\");break;case "+p":this.emit("set terminfo",{name:this.params[0]});break;case "+q":g=!1;this.send("\u001bP"+ +g+"+r"+k+"\u001b\\");break;case "tmux;\u001b":this.emit("passthrough",k);break;default:this.error("Unknown DCS prefix: %s.",k)}this.currentParam=0;this.prefix="";this.state=0}else if(this.currentParam+=e,!this.prefix)if(/^\d*;\d*\|/.test(this.currentParam))this.prefix=
D,this.params=this.currentParam.split(/[;|]/).map(function(a){return a.length?+a:0}).slice(0,-1),this.currentParam="";else if(/^[$+][a-zA-Z]/.test(this.currentParam)||/^\w+;\x1b/.test(this.currentParam))this.prefix=this.currentParam,this.currentParam="";break;case 6:if("\u001b"===this.lch&&"\\"===e||"\u0007"===e)this.state=0}}this.updateRange(this.y);this.refresh(this.refreshStart,this.refreshEnd);return!0};c.prototype.writeln=function(a){return this.write(a+"\r\n")};c.prototype.end=function(a){var b=
!0;a&&(b=this.write(a));this.destroySoon();return b};c.prototype.resume=function(){};c.prototype.pause=function(){};c.prototype.keyDown=function(a){var b=this;switch(a.keyCode){case 8:if(a.altKey){var d="\u0017";break}if(a.shiftKey){d="\b";break}d="\u007f";break;case 9:if(a.shiftKey){d="\u001b[Z";break}d="\t";break;case 13:d="\r";break;case 27:d="\u001b";break;case 37:if(this.applicationCursor){d="\u001bOD";break}if(a.ctrlKey){d="\u001b[5D";break}d="\u001b[D";break;case 39:if(this.applicationCursor){d=
"\u001bOC";break}if(a.ctrlKey){d="\u001b[5C";break}d="\u001b[C";break;case 38:if(this.applicationCursor){d="\u001bOA";break}if(a.ctrlKey)return this.scrollDisp(-1),p(a);d="\u001b[A";break;case 40:if(this.applicationCursor){d="\u001bOB";break}if(a.ctrlKey)return this.scrollDisp(1),p(a);d="\u001b[B";break;case 46:d="\u001b[3~";break;case 45:d="\u001b[2~";break;case 36:if(this.applicationKeypad){d="\u001bOH";break}d="\u001bOH";break;case 35:if(this.applicationKeypad){d="\u001bOF";break}d="\u001bOF";
break;case 33:if(a.shiftKey)return this.scrollDisp(-(this.rows-1)),p(a);d="\u001b[5~";break;case 34:if(a.shiftKey)return this.scrollDisp(this.rows-1),p(a);d="\u001b[6~";break;case 112:d="\u001bOP";break;case 113:d="\u001bOQ";break;case 114:d="\u001bOR";break;case 115:d="\u001bOS";break;case 116:d="\u001b[15~";break;case 117:d="\u001b[17~";break;case 118:d="\u001b[18~";break;case 119:d="\u001b[19~";break;case 120:d="\u001b[20~";break;case 121:d="\u001b[21~";break;case 122:d="\u001b[23~";break;case 123:d=
"\u001b[24~";break;default:if(a.ctrlKey)if(65<=a.keyCode&&90>=a.keyCode){if(this.screenKeys&&!this.prefixMode&&!this.selectMode&&65===a.keyCode)return this.enterPrefix(),p(a);if(this.prefixMode&&86===a.keyCode){this.leavePrefix();return}if((this.prefixMode||this.selectMode)&&67===a.keyCode){this.visualMode&&u(function(){b.leaveVisual()},1);return}d=t.fromCharCode(a.keyCode-64)}else 32===a.keyCode?d=t.fromCharCode(0):51<=a.keyCode&&55>=a.keyCode?d=t.fromCharCode(a.keyCode-51+27):56===a.keyCode?d=t.fromCharCode(127):
219===a.keyCode?d=t.fromCharCode(27):221===a.keyCode&&(d=t.fromCharCode(29));else a.altKey&&(65<=a.keyCode&&90>=a.keyCode?d="\u001b"+t.fromCharCode(a.keyCode+32):192===a.keyCode?d="\u001b`":48<=a.keyCode&&57>=a.keyCode&&(d="\u001b"+(a.keyCode-48)))}if(!d)return!0;if(this.prefixMode)return this.leavePrefix(),p(a);if(this.selectMode)return this.keySelect(a,d),p(a);this.emit("keydown",a);this.emit("key",d,a);this.showCursor();this.handler(d);return p(a)};c.prototype.setgLevel=function(a){this.glevel=
a;this.charset=this.charsets[a]};c.prototype.setgCharset=function(a,b){this.charsets[a]=b;this.glevel===a&&(this.charset=b)};c.prototype.keyPress=function(a){if(!this._textarea){p(a);if(a.charCode)var b=a.charCode;else if(null==a.which)b=a.keyCode;else if(0!==a.which&&0!==a.charCode)b=a.which;else return!1;if(!b||a.ctrlKey||a.altKey||a.metaKey)return!1;b=t.fromCharCode(b);if(this.prefixMode)return this.leavePrefix(),this.keyPrefix(a,b),!1;if(this.selectMode)return this.keySelect(a,b),!1;this.emit("keypress",
b,a);this.emit("key",b,a);this.showCursor();this.handler(b);return!1}};c.prototype.send=function(a){var b=this;this.queue||u(function(){b.handler(b.queue);b.queue=""},1);this.queue+=a};c.prototype.bell=function(){this.emit("bell");if(this.visualBell){var a=this;this.element.style.borderColor="white";u(function(){a.element.style.borderColor=""},10);this.popOnBell&&this.focus()}};c.prototype.log=function(){if(this.debug&&this.context.console&&this.context.console.log){var a=Array.prototype.slice.call(arguments);
this.context.console.log.apply(this.context.console,a)}};c.prototype.error=function(){if(this.debug&&this.context.console&&this.context.console.error){var a=Array.prototype.slice.call(arguments);this.context.console.error.apply(this.context.console,a)}};c.prototype.resize=function(a,b){var d;1>a&&(a=1);1>b&&(b=1);var e=this.cols;if(e<a){var c=[this.defAttr," "];for(d=this.lines.length;d--;)for(;this.lines[d].length<a;)this.lines[d].push(c)}else if(e>a)for(d=this.lines.length;d--;)for(;this.lines[d].length>
a;)this.lines[d].pop();this.setupStops(e);this.columns=this.cols=a;e=this.rows;if(e<b)for(c=this.element;e++<b;)this.lines.length<b+this.ybase&&this.lines.push(this.blankLine()),this.children.length<b&&(d=this.document.createElement("div"),c.appendChild(d),this.children.push(d));else if(e>b)for(;e-- >b;)this.lines.length>b+this.ybase&&this.lines.pop(),this.children.length>b&&(c=this.children.pop())&&c.parentNode.removeChild(c);this.rows=b;this.y>=b&&(this.y=b-1);this.x>=a&&(this.x=a-1);this.scrollTop=
0;this.scrollBottom=b-1;this.refresh(0,this.rows-1);this.normal=null;this.emit("resize")};c.prototype.updateRange=function(a){a<this.refreshStart&&(this.refreshStart=a);a>this.refreshEnd&&(this.refreshEnd=a)};c.prototype.maxRange=function(){this.refreshStart=0;this.refreshEnd=this.rows-1};c.prototype.setupStops=function(a){null!=a?this.tabs[a]||(a=this.prevStop(a)):(this.tabs={},a=0);for(;a<this.cols;a+=8)this.tabs[a]=!0};c.prototype.prevStop=function(a){null==a&&(a=this.x);for(;!this.tabs[--a]&&
0<a;);return a>=this.cols?this.cols-1:0>a?0:a};c.prototype.nextStop=function(a){null==a&&(a=this.x);for(;!this.tabs[++a]&&a<this.cols;);return a>=this.cols?this.cols-1:0>a?0:a};c.prototype.eraseAttr=function(){return this.defAttr&-512|this.curAttr&511};c.prototype.eraseRight=function(a,b){for(var d=this.lines[this.ybase+b],e=[this.eraseAttr()," "];a<this.cols;a++)d[a]=e;this.updateRange(b)};c.prototype.eraseLeft=function(a,b){var d=this.lines[this.ybase+b],e=[this.eraseAttr()," "];for(a++;a--;)d[a]=
e;this.updateRange(b)};c.prototype.eraseLine=function(a){this.eraseRight(0,a)};c.prototype.blankLine=function(a){a=[a?this.eraseAttr():this.defAttr," "];for(var b=[],d=0;d<this.cols;d++)b[d]=a;return b};c.prototype.ch=function(a){return a?[this.eraseAttr()," "]:[this.defAttr," "]};c.prototype.is=function(a){return 0===(this.termName+"").indexOf(a)};c.prototype.handler=function(a){this.emit("data",a)};c.prototype.handleTitle=function(a){this.emit("title",a)};c.prototype.index=function(){this.y++;this.y>
this.scrollBottom&&(this.y--,this.scroll());this.state=0};c.prototype.reverseIndex=function(){this.y--;if(this.y<this.scrollTop){this.y++;this.lines.splice(this.y+this.ybase,0,this.blankLine(!0));var a=this.rows-1-this.scrollBottom;this.lines.splice(this.rows-1+this.ybase-a+1,1);this.updateRange(this.scrollTop);this.updateRange(this.scrollBottom)}this.state=0};c.prototype.reset=function(){this.options.rows=this.rows;this.options.cols=this.cols;c.call(this,this.options);this.refresh(0,this.rows-1)};
c.prototype.tabSet=function(){this.tabs[this.x]=!0;this.state=0};c.prototype.cursorUp=function(a){a=a[0];1>a&&(a=1);this.y-=a;0>this.y&&(this.y=0)};c.prototype.cursorDown=function(a){a=a[0];1>a&&(a=1);this.y+=a;this.y>=this.rows&&(this.y=this.rows-1)};c.prototype.cursorForward=function(a){a=a[0];1>a&&(a=1);this.x+=a;this.x>=this.cols&&(this.x=this.cols-1)};c.prototype.cursorBackward=function(a){a=a[0];1>a&&(a=1);this.x-=a;0>this.x&&(this.x=0)};c.prototype.cursorPos=function(a){var b=a[0]-1;a=2<=a.length?
a[1]-1:0;0>b?b=0:b>=this.rows&&(b=this.rows-1);0>a?a=0:a>=this.cols&&(a=this.cols-1);this.x=a;this.y=b};c.prototype.eraseInDisplay=function(a){switch(a[0]){case 0:this.eraseRight(this.x,this.y);for(a=this.y+1;a<this.rows;a++)this.eraseLine(a);break;case 1:this.eraseLeft(this.x,this.y);for(a=this.y;a--;)this.eraseLine(a);break;case 2:for(a=this.rows;a--;)this.eraseLine(a)}};c.prototype.eraseInLine=function(a){switch(a[0]){case 0:this.eraseRight(this.x,this.y);break;case 1:this.eraseLeft(this.x,this.y);
break;case 2:this.eraseLine(this.y)}};c.prototype.charAttributes=function(a){if(1===a.length&&0===a[0])this.curAttr=this.defAttr;else{for(var b=a.length,d=0,e=this.curAttr>>18,c=this.curAttr>>9&511,g=this.curAttr&511,f;d<b;d++)f=a[d],30<=f&&37>=f?c=f-30:40<=f&&47>=f?g=f-40:90<=f&&97>=f?(f+=8,c=f-90):100<=f&&107>=f?(f+=8,g=f-100):0===f?(e=this.defAttr>>18,c=this.defAttr>>9&511,g=this.defAttr&511):1===f?e|=1:4===f?e|=2:5===f?e|=4:7===f?e|=8:8===f?e|=16:22===f?e&=-2:24===f?e&=-3:25===f?e&=-5:27===f?
e&=-9:28===f?e&=-17:39===f?c=this.defAttr>>9&511:49===f?g=this.defAttr&511:38===f?2===a[d+1]?(d+=2,c=v(a[d]&255,a[d+1]&255,a[d+2]&255),-1===c&&(c=511),d+=2):5===a[d+1]&&(d+=2,c=f=a[d]&255):48===f?2===a[d+1]?(d+=2,g=v(a[d]&255,a[d+1]&255,a[d+2]&255),-1===g&&(g=511),d+=2):5===a[d+1]&&(d+=2,g=f=a[d]&255):100===f?(c=this.defAttr>>9&511,g=this.defAttr&511):this.error("Unknown SGR attribute: %d.",f);this.curAttr=e<<18|c<<9|g}};c.prototype.deviceStatus=function(a){if(!this.prefix)switch(a[0]){case 5:this.send("\u001b[0n");
break;case 6:this.send("\u001b["+(this.y+1)+";"+(this.x+1)+"R")}else if("?"===this.prefix)switch(a[0]){case 6:this.send("\u001b[?"+(this.y+1)+";"+(this.x+1)+"R")}};c.prototype.insertChars=function(a){var b;a=a[0];1>a&&(a=1);var d=this.y+this.ybase;var e=this.x;for(b=[this.eraseAttr()," "];a--&&e<this.cols;)this.lines[d].splice(e++,0,b),this.lines[d].pop()};c.prototype.cursorNextLine=function(a){a=a[0];1>a&&(a=1);this.y+=a;this.y>=this.rows&&(this.y=this.rows-1);this.x=0};c.prototype.cursorPrecedingLine=
function(a){a=a[0];1>a&&(a=1);this.y-=a;0>this.y&&(this.y=0);this.x=0};c.prototype.cursorCharAbsolute=function(a){a=a[0];1>a&&(a=1);this.x=a-1};c.prototype.insertLines=function(a){a=a[0];1>a&&(a=1);var b=this.y+this.ybase;var d=this.rows-1-this.scrollBottom;for(d=this.rows-1+this.ybase-d+1;a--;)this.lines.splice(b,0,this.blankLine(!0)),this.lines.splice(d,1);this.updateRange(this.y);this.updateRange(this.scrollBottom)};c.prototype.deleteLines=function(a){a=a[0];1>a&&(a=1);var b=this.y+this.ybase;
var d=this.rows-1-this.scrollBottom;for(d=this.rows-1+this.ybase-d;a--;)this.lines.splice(d+1,0,this.blankLine(!0)),this.lines.splice(b,1);this.updateRange(this.y);this.updateRange(this.scrollBottom)};c.prototype.deleteChars=function(a){var b;a=a[0];1>a&&(a=1);var d=this.y+this.ybase;for(b=[this.eraseAttr()," "];a--;)this.lines[d].splice(this.x,1),this.lines[d].push(b)};c.prototype.eraseChars=function(a){var b;a=a[0];1>a&&(a=1);var d=this.y+this.ybase;var e=this.x;for(b=[this.eraseAttr()," "];a--&&
e<this.cols;)this.lines[d][e++]=b};c.prototype.charPosAbsolute=function(a){a=a[0];1>a&&(a=1);this.x=a-1;this.x>=this.cols&&(this.x=this.cols-1)};c.prototype.HPositionRelative=function(a){a=a[0];1>a&&(a=1);this.x+=a;this.x>=this.cols&&(this.x=this.cols-1)};c.prototype.sendDeviceAttributes=function(a){0<a[0]||(this.prefix?">"===this.prefix&&(this.is("xterm")?this.send("\u001b[>0;276;0c"):this.is("rxvt-unicode")?this.send("\u001b[>85;95;0c"):this.is("linux")?this.send(a[0]+"c"):this.is("screen")&&this.send("\u001b[>83;40003;0c")):
this.is("xterm")||this.is("rxvt-unicode")||this.is("screen")?this.send("\u001b[?1;2c"):this.is("linux")&&this.send("\u001b[?6c"))};c.prototype.linePosAbsolute=function(a){a=a[0];1>a&&(a=1);this.y=a-1;this.y>=this.rows&&(this.y=this.rows-1)};c.prototype.VPositionRelative=function(a){a=a[0];1>a&&(a=1);this.y+=a;this.y>=this.rows&&(this.y=this.rows-1)};c.prototype.HVPosition=function(a){1>a[0]&&(a[0]=1);1>a[1]&&(a[1]=1);this.y=a[0]-1;this.y>=this.rows&&(this.y=this.rows-1);this.x=a[1]-1;this.x>=this.cols&&
(this.x=this.cols-1)};c.prototype.setMode=function(a){if("object"===typeof a)for(var b=a.length,d=0;d<b;d++)this.setMode(a[d]);else if(!this.prefix)switch(a){case 4:this.insertMode=!0}else if("?"===this.prefix)switch(a){case 1:this.applicationCursor=!0;break;case 2:this.setgCharset(0,c.charsets.US);this.setgCharset(1,c.charsets.US);this.setgCharset(2,c.charsets.US);this.setgCharset(3,c.charsets.US);break;case 3:this.savedCols=this.cols;this.resize(132,this.rows);break;case 6:this.originMode=!0;break;
case 7:this.wraparoundMode=!0;break;case 66:this.log("Serial port requested applications keypad.");this.applicationKeypad=!0;break;case 9:case 1E3:case 1002:case 1003:this.x10Mouse=9===a;this.vt200Mouse=1E3===a;this.normalMouse=1E3<a;this.mouseEvents=!0;this.element.style.cursor="default";this.log("Binding to mouse events.");break;case 1004:this.sendFocus=!0;break;case 1005:this.utfMouse=!0;break;case 1006:this.sgrMouse=!0;break;case 1015:this.urxvtMouse=!0;break;case 25:this.cursorHidden=!1;break;
case 1049:case 47:case 1047:this.normal||(a={lines:this.lines,ybase:this.ybase,ydisp:this.ydisp,x:this.x,y:this.y,scrollTop:this.scrollTop,scrollBottom:this.scrollBottom,tabs:this.tabs},this.reset(),this.normal=a,this.showCursor())}};c.prototype.resetMode=function(a){if("object"===typeof a)for(var b=a.length,d=0;d<b;d++)this.resetMode(a[d]);else if(!this.prefix)switch(a){case 4:this.insertMode=!1}else if("?"===this.prefix)switch(a){case 1:this.applicationCursor=!1;break;case 3:132===this.cols&&this.savedCols&&
this.resize(this.savedCols,this.rows);delete this.savedCols;break;case 6:this.originMode=!1;break;case 7:this.wraparoundMode=!1;break;case 66:this.log("Switching back to normal keypad.");this.applicationKeypad=!1;break;case 9:case 1E3:case 1002:case 1003:this.mouseEvents=this.normalMouse=this.vt200Mouse=this.x10Mouse=!1;this.element.style.cursor="";break;case 1004:this.sendFocus=!1;break;case 1005:this.utfMouse=!1;break;case 1006:this.sgrMouse=!1;break;case 1015:this.urxvtMouse=!1;break;case 25:this.cursorHidden=
!0;break;case 1049:case 47:case 1047:this.normal&&(this.lines=this.normal.lines,this.ybase=this.normal.ybase,this.ydisp=this.normal.ydisp,this.x=this.normal.x,this.y=this.normal.y,this.scrollTop=this.normal.scrollTop,this.scrollBottom=this.normal.scrollBottom,this.tabs=this.normal.tabs,this.normal=null,this.refresh(0,this.rows-1),this.showCursor())}};c.prototype.setScrollRegion=function(a){this.prefix||(this.scrollTop=(a[0]||1)-1,this.scrollBottom=(a[1]||this.rows)-1,this.y=this.x=0)};c.prototype.saveCursor=
function(a){this.savedX=this.x;this.savedY=this.y};c.prototype.restoreCursor=function(a){this.x=this.savedX||0;this.y=this.savedY||0};c.prototype.cursorForwardTab=function(a){for(a=a[0]||1;a--;)this.x=this.nextStop()};c.prototype.scrollUp=function(a){for(a=a[0]||1;a--;)this.lines.splice(this.ybase+this.scrollTop,1),this.lines.splice(this.ybase+this.scrollBottom,0,this.blankLine());this.updateRange(this.scrollTop);this.updateRange(this.scrollBottom)};c.prototype.scrollDown=function(a){for(a=a[0]||
1;a--;)this.lines.splice(this.ybase+this.scrollBottom,1),this.lines.splice(this.ybase+this.scrollTop,0,this.blankLine());this.updateRange(this.scrollTop);this.updateRange(this.scrollBottom)};c.prototype.initMouseTracking=function(a){};c.prototype.resetTitleModes=function(a){};c.prototype.cursorBackwardTab=function(a){for(a=a[0]||1;a--;)this.x=this.prevStop()};c.prototype.repeatPrecedingCharacter=function(a){a=a[0]||1;for(var b=this.lines[this.ybase+this.y],d=b[this.x-1]||[this.defAttr," "];a--;)b[this.x++]=
d};c.prototype.tabClear=function(a){a=a[0];0>=a?delete this.tabs[this.x]:3===a&&(this.tabs={})};c.prototype.mediaCopy=function(a){};c.prototype.setResources=function(a){};c.prototype.disableModifiers=function(a){};c.prototype.setPointerMode=function(a){};c.prototype.softReset=function(a){this.applicationCursor=this.applicationKeypad=this.wraparoundMode=this.originMode=this.insertMode=this.cursorHidden=!1;this.scrollTop=0;this.scrollBottom=this.rows-1;this.curAttr=this.defAttr;this.x=this.y=0;this.charset=
null;this.glevel=0;this.charsets=[null]};c.prototype.requestAnsiMode=function(a){};c.prototype.requestPrivateMode=function(a){};c.prototype.setConformanceLevel=function(a){};c.prototype.loadLEDs=function(a){};c.prototype.setCursorStyle=function(a){};c.prototype.setCharProtectionAttr=function(a){};c.prototype.restorePrivateValues=function(a){};c.prototype.setAttrInRectangle=function(a){for(var b=a[0],d=a[1],e=a[2],c=a[3],g=a[4],f,h;b<e+1;b++)for(f=this.lines[this.ybase+b],h=d;h<c;h++)f[h]=[g,f[h][1]];
this.updateRange(a[0]);this.updateRange(a[2])};c.prototype.savePrivateValues=function(a){};c.prototype.manipulateWindow=function(a){};c.prototype.reverseAttrInRectangle=function(a){};c.prototype.setTitleModeFeature=function(a){};c.prototype.setWarningBellVolume=function(a){};c.prototype.setMarginBellVolume=function(a){};c.prototype.copyRectangle=function(a){};c.prototype.enableFilterRectangle=function(a){};c.prototype.requestParameters=function(a){};c.prototype.selectChangeExtent=function(a){};c.prototype.fillRectangle=
function(a){for(var b=a[0],d=a[1],e=a[2],c=a[3],g=a[4],f,h;d<c+1;d++)for(f=this.lines[this.ybase+d],h=e;h<g;h++)f[h]=[f[h][0],t.fromCharCode(b)];this.updateRange(a[1]);this.updateRange(a[3])};c.prototype.enableLocatorReporting=function(a){};c.prototype.eraseRectangle=function(a){var b=a[0],d=a[1],e=a[2],c=a[3],g,f;for(f=[this.eraseAttr()," "];b<e+1;b++){var h=this.lines[this.ybase+b];for(g=d;g<c;g++)h[g]=f}this.updateRange(a[0]);this.updateRange(a[2])};c.prototype.setLocatorEvents=function(a){};c.prototype.selectiveEraseRectangle=
function(a){};c.prototype.requestLocatorPosition=function(a){};c.prototype.insertColumns=function(){for(var a=params[0],b=this.ybase+this.rows,d=[this.eraseAttr()," "],e;a--;)for(e=this.ybase;e<b;e++)this.lines[e].splice(this.x+1,0,d),this.lines[e].pop();this.maxRange()};c.prototype.deleteColumns=function(){for(var a=params[0],b=this.ybase+this.rows,d=[this.eraseAttr()," "],e;a--;)for(e=this.ybase;e<b;e++)this.lines[e].splice(this.x,1),this.lines[e].push(d);this.maxRange()};c.prototype.enterPrefix=
function(){this.prefixMode=!0};c.prototype.leavePrefix=function(){this.prefixMode=!1};c.prototype.enterSelect=function(){this._real={x:this.x,y:this.y,ydisp:this.ydisp,ybase:this.ybase,cursorHidden:this.cursorHidden,lines:this.copyBuffer(this.lines),write:this.write};this.write=function(){};this.selectMode=!0;this.cursorHidden=this.visualMode=!1;this.refresh(this.y,this.y)};c.prototype.leaveSelect=function(){this.x=this._real.x;this.y=this._real.y;this.ydisp=this._real.ydisp;this.ybase=this._real.ybase;
this.cursorHidden=this._real.cursorHidden;this.lines=this._real.lines;this.write=this._real.write;delete this._real;this.visualMode=this.selectMode=!1;this.refresh(0,this.rows-1)};c.prototype.enterVisual=function(){this._real.preVisual=this.copyBuffer(this.lines);this.selectText(this.x,this.x,this.ydisp+this.y,this.ydisp+this.y);this.visualMode=!0};c.prototype.leaveVisual=function(){this.lines=this._real.preVisual;delete this._real.preVisual;delete this._selected;this.visualMode=!1;this.refresh(0,
this.rows-1)};c.prototype.enterSearch=function(a){this.entry="";this.searchMode=!0;this.searchDown=a;this._real.preSearch=this.copyBuffer(this.lines);this._real.preSearchX=this.x;this._real.preSearchY=this.y;a=this.ydisp+this.rows-1;for(var b=0;b<this.entryPrefix.length;b++)this.lines[a][b]=[this.defAttr&-512|4,this.entryPrefix[b]];this.y=this.rows-1;this.x=this.entryPrefix.length;this.refresh(this.rows-1,this.rows-1)};c.prototype.leaveSearch=function(){this.searchMode=!1;this._real.preSearch&&(this.lines=
this._real.preSearch,this.x=this._real.preSearchX,this.y=this._real.preSearchY,delete this._real.preSearch,delete this._real.preSearchX,delete this._real.preSearchY);this.refresh(this.rows-1,this.rows-1)};c.prototype.copyBuffer=function(a){a=a||this.lines;for(var b=[],d=0;d<a.length;d++){b[d]=[];for(var e=0;e<a[d].length;e++)b[d][e]=[a[d][e][0],a[d][e][1]]}return b};c.prototype.getCopyTextarea=function(a){a=this._copyTextarea;var b=this.document;a||(a=b.createElement("textarea"),a.style.position=
"absolute",a.style.left="-32000px",a.style.top="-32000px",a.style.width="0px",a.style.height="0px",a.style.opacity="0",a.style.backgroundColor="transparent",a.style.borderStyle="none",a.style.outlineStyle="none",b.getElementsByTagName("body")[0].appendChild(a),this._copyTextarea=a);return a};c.prototype.copyText=function(a){var b=this,d=this.getCopyTextarea();this.emit("copy",a);d.focus();d.textContent=a;d.value=a;d.setSelectionRange(0,a.length);u(function(){b.element.focus();b.focus()},1)};c.prototype.clearSelectedText=
function(){if(this._selected){var a;var b=this._selected.x1;var d=this._selected.x2;var e=this._selected.y1;var c=this._selected.y2;if(c<e){var g=d;d=b;b=g;g=c;c=e;e=g}d<b&&e===c&&(g=d,d=b,b=g);for(a=e;a<=c;a++){g=0;var f=this.cols-1;a===e&&(g=b);for(a===c&&(f=d);g<=f;g++)if(null!=this.lines[a][g].old){var h=this.lines[a][g].old;delete this.lines[a][g].old;this.lines[a][g]=[h,this.lines[a][g][1]]}}delete this._selected}};c.prototype.selectText=function(a,b,d,e){var c;this._selected&&this.clearSelectedText();
d=Math.max(d,0);d=Math.min(d,this.ydisp+this.rows-1);e=Math.max(e,0);e=Math.min(e,this.ydisp+this.rows-1);this._selected={x1:a,x2:b,y1:d,y2:e};if(e<d){var g=b;b=a;a=g;g=e;e=d;d=g}b<a&&d===e&&(g=b,b=a,a=g);for(c=d;c<=e;c++){g=0;var f=this.cols-1;c===d&&(g=a);for(c===e&&(f=b);g<=f;g++){var h=this.lines[c][g][0];this.lines[c][g]=[h&-512|261636,this.lines[c][g][1]];this.lines[c][g].old=h}}this.refresh(0,this.rows-1)};c.prototype.grabText=function(a,b,d,c){var e="",g="",f;if(c<d){var h=b;b=a;a=h;h=c;c=
d;d=h}b<a&&d===c&&(h=b,b=a,a=h);for(f=d;f<=c;f++){var n=0;var q=this.cols-1;f===d&&(n=a);for(f===c&&(q=b);n<=q;n++)h=this.lines[f][n][1]," "===h?g+=h:(g&&(e+=g,g=""),e+=h,A(h)&&n++);g="";e+="\n"}n=b;for(f=c;n<this.cols;n++)if(" "!==this.lines[f][n][1]){e=e.slice(0,-1);break}return e};c.prototype.keyPrefix=function(a,b){"k"===b||"&"===b?this.destroy():"p"===b||"]"===b?this.emit("request paste"):"c"===b?this.emit("request create"):"0"<=b&&"9">=b?(b=+b-1,~b||(b=9),this.emit("request term",b)):"n"===
b?this.emit("request term next"):"P"===b?this.emit("request term previous"):":"===b?this.emit("request command mode"):"["===b&&this.enterSelect()};c.prototype.keySelect=function(a,b){this.showCursor();if(this.searchMode||"n"===b||"N"===b)return this.keySearch(a,b);if("\u0004"===b){var d=this.ydisp+this.y;this.ydisp===this.ybase?(this.y=Math.min(this.y+(this.rows-1)/2|0,this.rows-1),this.refresh(0,this.rows-1)):this.scrollDisp((this.rows-1)/2|0);this.visualMode&&this.selectText(this.x,this.x,d,this.ydisp+
this.y)}else if("\u0015"===b)d=this.ydisp+this.y,0===this.ydisp?(this.y=Math.max(this.y-(this.rows-1)/2|0,0),this.refresh(0,this.rows-1)):this.scrollDisp(-(this.rows-1)/2|0),this.visualMode&&this.selectText(this.x,this.x,d,this.ydisp+this.y);else if("\u0006"===b)d=this.ydisp+this.y,this.scrollDisp(this.rows-1),this.visualMode&&this.selectText(this.x,this.x,d,this.ydisp+this.y);else if("\u0002"===b)d=this.ydisp+this.y,this.scrollDisp(-(this.rows-1)),this.visualMode&&this.selectText(this.x,this.x,d,
this.ydisp+this.y);else if("k"===b||"\u001b[A"===b)d=this.ydisp+this.y,this.y--,0>this.y&&(this.y=0,this.scrollDisp(-1)),this.visualMode?this.selectText(this.x,this.x,d,this.ydisp+this.y):this.refresh(this.y,this.y+1);else if("j"===b||"\u001b[B"===b)d=this.ydisp+this.y,this.y++,this.y>=this.rows&&(this.y=this.rows-1,this.scrollDisp(1)),this.visualMode?this.selectText(this.x,this.x,d,this.ydisp+this.y):this.refresh(this.y-1,this.y);else if("h"===b||"\u001b[D"===b){var c=this.x;this.x--;0>this.x&&(this.x=
0);this.visualMode?this.selectText(c,this.x,this.ydisp+this.y,this.ydisp+this.y):this.refresh(this.y,this.y)}else if("l"===b||"\u001b[C"===b)c=this.x,this.x++,this.x>=this.cols&&(this.x=this.cols-1),this.visualMode?this.selectText(c,this.x,this.ydisp+this.y,this.ydisp+this.y):this.refresh(this.y,this.y);else if("v"===b||" "===b)this.visualMode?this.leaveVisual():this.enterVisual();else if("y"===b)this.visualMode&&(d=this.grabText(this._selected.x1,this._selected.x2,this._selected.y1,this._selected.y2),
this.copyText(d),this.leaveVisual());else if("q"===b||"\u001b"===b)this.visualMode?this.leaveVisual():this.leaveSelect();else if("w"===b||"W"===b){var k=this.x,g=this.y,f=this.ydisp;c=this.x;d=this.y;for(var h=this.ydisp,n=!1;;){for(var q=this.lines[h+d];c<this.cols;){if(" ">=q[c][1])n=!0;else if(n)break;c++}c>=this.cols&&(c=this.cols-1);if(c===this.cols-1&&" ">=q[c][1]){if(c=0,++d>=this.rows&&(d--,++h>this.ybase)){h=this.ybase;c=this.x;break}}else break}this.x=c;this.y=d;this.scrollDisp(-this.ydisp+
h);this.visualMode&&this.selectText(k,this.x,g+f,this.ydisp+this.y)}else if("b"===b||"B"===b){k=this.x;g=this.y;f=this.ydisp;c=this.x;d=this.y;for(h=this.ydisp;;){q=this.lines[h+d];for(n=0<c&&" "<q[c][1]&&" "<q[c-1][1];0<=c;){if(" ">=q[c][1])if(n&&c+1<this.cols&&" "<q[c+1][1]){c++;break}else n=!0;c--}0>c&&(c=0);if(0===c&&(" ">=q[c][1]||!n)){if(c=this.cols-1,0>--d&&(d++,0>--h)){h++;c=0;break}}else break}this.x=c;this.y=d;this.scrollDisp(-this.ydisp+h);this.visualMode&&this.selectText(k,this.x,g+f,
this.ydisp+this.y)}else if("e"===b||"E"===b){c=this.x+1;d=this.y;h=this.ydisp;for(c>=this.cols&&c--;;){for(q=this.lines[h+d];c<this.cols;)if(" ">=q[c][1])c++;else break;for(;c<this.cols;){if(" ">=q[c][1]&&0<=c-1&&" "<q[c-1][1]){c--;break}c++}c>=this.cols&&(c=this.cols-1);if(c===this.cols-1&&" ">=q[c][1]){if(c=0,++d>=this.rows&&(d--,++h>this.ybase)){h=this.ybase;break}}else break}this.x=c;this.y=d;this.scrollDisp(-this.ydisp+h);this.visualMode&&this.selectText(k,this.x,g+f,this.ydisp+this.y)}else if("^"===
b||"0"===b){k=this.x;if("0"===b)this.x=0;else if("^"===b){q=this.lines[this.ydisp+this.y];for(c=0;c<this.cols&&!(" "<q[c][1]);)c++;c>=this.cols&&(c=this.cols-1);this.x=c}this.visualMode?this.selectText(k,this.x,this.ydisp+this.y,this.ydisp+this.y):this.refresh(this.y,this.y)}else if("$"===b){k=this.x;q=this.lines[this.ydisp+this.y];for(c=this.cols-1;0<=c;){if(" "<q[c][1]){this.visualMode&&c<this.cols-1&&c++;break}c--}0>c&&(c=0);this.x=c;this.visualMode?this.selectText(k,this.x,this.ydisp+this.y,this.ydisp+
this.y):this.refresh(this.y,this.y)}else if("g"===b||"G"===b)k=this.x,g=this.y,f=this.ydisp,"g"===b?(this.y=this.x=0,this.scrollDisp(-this.ydisp)):"G"===b&&(this.x=0,this.y=this.rows-1,this.scrollDisp(this.ybase)),this.visualMode&&this.selectText(k,this.x,g+f,this.ydisp+this.y);else if("H"===b||"M"===b||"L"===b)k=this.x,g=this.y,"H"===b?this.y=this.x=0:"M"===b?(this.x=0,this.y=this.rows/2|0):"L"===b&&(this.x=0,this.y=this.rows-1),this.visualMode?this.selectText(k,this.x,this.ydisp+g,this.ydisp+this.y):
(this.refresh(g,g),this.refresh(this.y,this.y));else if("{"===b||"}"===b){k=this.x;g=this.y;f=this.ydisp;n=c=!1;var m=-1;d=this.y+("{"===b?-1:1);h=this.ydisp;var l;"{"===b?0>d&&(d++,0<h&&h--):"}"===b&&d>=this.rows&&(d--,h<this.ybase&&h++);for(;;){q=this.lines[h+d];for(l=0;l<this.cols;l++)if(" "<q[l][1]){-1===m&&(m=0);c=!0;break}else if(l===this.cols-1){-1===m?m=1:0===m?n=!0:1===m&&c&&(n=!0);break}if(n)break;if("{"===b){if(d--,0>d)if(d++,0<h)h--;else break}else if("}"===b&&(d++,d>=this.rows))if(d--,
h<this.ybase)h++;else break}n||("{"===b?h=d=0:"}"===b&&(d=this.rows-1,h=this.ybase));this.x=0;this.y=d;this.scrollDisp(-this.ydisp+h);this.visualMode&&this.selectText(k,this.x,g+f,this.ydisp+this.y)}else if("/"===b||"?"===b)this.visualMode||this.enterSearch("/"===b);else return!1};c.prototype.keySearch=function(a,b){if("\u001b"===b)this.leaveSearch();else if("\r"!==b&&(this.searchMode||"n"!==b&&"N"!==b))if("\b"===b||"\u007f"===b){if(0!==this.entry.length){var d=this.ydisp+this.rows-1;this.entry=this.entry.slice(0,
-1);l=this.entryPrefix.length+this.entry.length;this.lines[d][l]=[this.lines[d][l][0]," "];this.x--;this.refresh(this.rows-1,this.rows-1);this.refresh(this.y,this.y)}}else if(1===b.length&&" "<=b&&"~">=b)d=this.ydisp+this.rows-1,this.entry+=b,l=this.entryPrefix.length+this.entry.length-1,this.lines[d][l]=[this.defAttr&-512|4,b],this.x++,this.refresh(this.rows-1,this.rows-1),this.refresh(this.y,this.y);else return!1;else{this.leaveSearch();var c=this.entry;if(c){d=this.x;for(var k=this.y,g=this.ydisp,
f,h=!1,n=!1,m=this.x+1,p=this.ydisp+this.y,l,r="N"===b?this.searchDown:!this.searchDown;;){for(f=this.lines[p];m<this.cols;){for(l=0;l<c.length&&!(m+l>=this.cols)&&f[m+l][1]===c[l];l++)if(f[m+l][1]===c[l]&&l===c.length-1){h=!0;break}if(h)break;m+=l+1}if(h)break;m=0;if(r){if(p--,0>p){if(n)break;n=!0;p=this.ybase+this.rows-1}}else if(p++,p>this.ybase+this.rows-1){if(n)break;n=!0;p=0}}h?(0>p-this.ybase?(l=p,p=0,l>this.ybase&&(p=l-this.ybase,l=this.ybase)):(l=this.ybase,p-=this.ybase),this.x=m,this.y=
p,this.scrollDisp(-this.ydisp+l),this.visualMode&&this.selectText(d,this.x,k+g,this.ydisp+this.y)):this.refresh(0,this.rows-1)}else this.refresh(0,this.rows-1)}};c.charsets={};c.charsets.SCLD={"`":"\u25c6",a:"\u2592",b:"\t",c:"\f",d:"\r",e:"\n",f:"\u00b0",g:"\u00b1",h:"\u2424",i:"\x0B",j:"\u2518",k:"\u2510",l:"\u250c",m:"\u2514",n:"\u253c",o:"\u23ba",p:"\u23bb",q:"\u2500",r:"\u23bc",s:"\u23bd",t:"\u251c",u:"\u2524",v:"\u2534",w:"\u252c",x:"\u2502",y:"\u2264",z:"\u2265","{":"\u03c0","|":"\u2260","}":"\u00a3",
"~":"\u00b7"};c.charsets.UK=null;c.charsets.US=null;c.charsets.Dutch=null;c.charsets.Finnish=null;c.charsets.French=null;c.charsets.FrenchCanadian=null;c.charsets.German=null;c.charsets.Italian=null;c.charsets.NorwegianDanish=null;c.charsets.Spanish=null;c.charsets.Swedish=null;c.charsets.Swiss=null;c.charsets.ISOLatin=null;var t=this.String,u=this.setTimeout,F=this.setInterval;v._cache={};v.distance=function(a,b,c,e,k,g){return Math.pow(30*(a-e),2)+Math.pow(59*(b-k),2)+Math.pow(11*(c-g),2)};c.EventEmitter=
r;c.Stream=w;c.inherits=z;c.on=m;c.off=y;c.cancel=p;"undefined"!==typeof module?module.exports=c:this.Terminal=c}).call(function(){return this||("undefined"!==typeof window?window:global)}());