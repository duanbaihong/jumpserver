var checked=!1;function check_all(a){a=document.getElementById(a);checked=!1===checked?!0:!1;for(var b=0;b<a.elements.length;b++)"checkbox"==a.elements[b].type&&(a.elements[b].checked=checked)}function checkAll(a,b){var c=document.getElementsByName(b);if(document.getElementById(a).checked)for(var d=0;d<c.length;d++)c[d].checked=1;else for(d=0;d<c.length;d++)c[d].checked=0}
function GetRowData(a){for(var b={},c=0;c<a.cells.length;c++)if(name=a.parentNode.rows[0].cells[c].getAttribute("Name")){var d=a.cells[c].getAttribute("Value");d||(d=a.cells[c].innerHTML);b[name]=d}return b}
function GetTableDataBox(){var a=document.getElementById("editable"),b=[],c=[],d=document.getElementById("contents_form"),e=[];len=d.elements.length;for(var f=0;f<len;f++)"checkbox"==d.elements[f].type&&!0===d.elements[f].checked&&"checkall"!=d.elements[f].value&&e.push(f);for(f in e)b.push(GetRowData(a.rows[e[f]]));0===e.length&&alert("\u8bf7\u81f3\u5c11\u9009\u62e9\u4e00\u884c\uff01");c.push(b);c.push(e.length);return c}
function move(a,b,c,d){$("#"+a+" option").each(function(){!0===$(this).prop("selected")&&($("#"+b).append(this),"undefined"!==typeof c&&$("#"+d).append($("#"+c+" option[value='"+this.value+"']")))})}function move_left(a,b,c,d){$("#"+a+" option").each(function(){!0===$(this).prop("selected")&&($("#"+b).append(this),"undefined"!==typeof c&&$("#"+d).append($("#"+c+" option[value='"+this.value+"']")));$(this).attr("selected","true")})}
function selectAll(){$("option").each(function(){$(this).attr("selected",!0)})}function getCookie(a){var b=null;if(document.cookie&&""!==document.cookie)for(var c=document.cookie.split(";"),d=0;d<c.length;d++){var e=jQuery.trim(c[d]);e.substring(0,a.length+1)===a+"="&&(b=decodeURIComponent(e.substring(a.length+1)))}return b}function csrfSafeMethod(a){return/^(GET|HEAD|OPTIONS|TRACE)$/.test(a)}
function setAjaxCSRFToken(){var a=getCookie("csrftoken");getCookie("sessionid");$.ajaxSetup({beforeSend:function(b,c){csrfSafeMethod(c.type)||this.crossDomain||b.setRequestHeader("X-CSRFToken",a)}})}
function activeNav(){var a=document.location.pathname.split("/"),b=a[1],c=a[2];""===b?$("#index").addClass("active"):"xpack"===b&&"cloud"===c?(a=a[3],$("#"+b).addClass("active"),$("#"+b+" #"+c).addClass("active"),$("#"+b+" #"+c+" #"+a+" a").css("color","#ffffff")):"settings"===b?$("#"+b).addClass("active"):($("#"+b).addClass("active"),$("#"+b+" #"+c).addClass("active"))}
function formSubmit(a){a=a||{};var b=a.data||a.form.serializeObject(),c=a.redirect_to;$.ajax({url:a.url,type:a.method||"POST",data:JSON.stringify(b),contentType:a.content_type||"application/json; charset=utf-8",dataType:a.data_type||"json"}).done(function(b,e,f){if(c)location.href=c;else if("function"===typeof a.success)return a.success(b,e,f)}).fail(function(b,c,f){if("function"===typeof a.error)return a.error(b,c,f);if(!a.form)alert(b.responseText);else if(400===b.status){b=b.responseJSON;c=a.form.children(".alert-danger");
1!==c.length&&(a.form.prepend('<div class="alert alert-danger" style="display: none"></div>'),c=a.form.children(".alert-danger"));var e="";c.css("display","none");c.html("");a.form.find(".help-block.error").html("");a.form.find(".form-group.has-error").removeClass("has-error");"object"!==typeof b?(e=b,1===c.length&&(c.css("display","block"),c.html(e))):($.each(b,function(b,c){var f=a.form.find('input[name="'+b+'"]'),d=f.parents(".form-group"),g=f.parent(),h=g.children(".help-block.error");0===h.length&&
(g.append('<div class="help-block error"></div>'),h=g.children(".help-block.error"));1===f.length&&1===d.length?(d.addClass("has-error"),f=c.join("<br/>"),h.html(f)):e+=c+"<br/>"}),1===c.length&&""!==e&&(c.css("display","block"),c.html(e)))}})}
function APIUpdateAttr(a){a=a||{};var b=a.success_message,c=gettext("Update is successful!"),d=a.fail_message,e=gettext("An unknown error occurred while updating.."),f=a.flash_message||!0;!1===a.flash_message&&(f=!1);$.ajax({url:a.url,type:a.method||"PATCH",data:a.body,contentType:a.content_type||"application/json; charset=utf-8",dataType:a.data_type||"json"}).done(function(e,g,k){f&&toastr.success(d?b:c);if("function"===typeof a.success)return a.success(e)}).fail(function(b,c,k){f&&(c="",d?c=d:b.responseJSON&&
(b.responseJSON.error?c=b.responseJSON.error:b.responseJSON.msg&&(c=b.responseJSON.msg)),""===c&&(c=e),toastr.error(c));if("function"===typeof a.error)return console.log(b),a.error(b.responseText,b.status)})}
function objectDelete(a,b,c,d){function e(){APIUpdateAttr({url:c,body:JSON.stringify({}),method:"DELETE",success_message:gettext("Delete the success"),success:function(){d?window.location.href=d:$(a).parent().parent().remove()},error:function(){swal(gettext("Error"),"[ "+b+" ]"+gettext("Being used by the asset, please unbind the asset first."),"error")}})}swal({title:gettext("Are you sure about deleting it?"),text:" ["+b+"] ",type:"warning",showCancelButton:!0,cancelButtonText:gettext("Cancel"),confirmButtonColor:"#ed5565",
confirmButtonText:gettext("Confirm"),closeOnConfirm:!0},function(){e()})}
function orgDelete(a,b,c,d){function e(){APIUpdateAttr({url:c,body:JSON.stringify({}),method:"DELETE",success_message:gettext("Delete the success"),success:function(){d?window.location.href=d:$(a).parent().parent().remove()},error:function(a,c){400===c?swal(gettext("Error"),"[ "+b+" ] "+gettext("The organization contains undeleted information. Please try again after deleting"),"error"):405===c&&swal(gettext("Error")," [ "+b+" ] "+gettext("Do not perform this operation under this organization. Try again after switching to another organization"),
"error")}})}swal({title:gettext("Please ensure that the following information in the organization has been deleted"),text:gettext("User list\u3001User group\u3001Asset list\u3001Domain list\u3001Admin user\u3001System user\u3001Labels\u3001Asset permission"),type:"warning",showCancelButton:!0,cancelButtonText:gettext("Cancel"),confirmButtonColor:"#ed5565",confirmButtonText:gettext("Confirm"),closeOnConfirm:!0},function(){e()})}
$.fn.serializeObject=function(){var a={},b=this.serializeArray();$.each(b,function(){void 0!==a[this.name]?(a[this.name].push||(a[this.name]=[a[this.name]]),a[this.name].push(this.value||"")):a[this.name]=this.value||""});return a};function makeLabel(a){return"<label class='detail-key'><b>"+a[0]+": </b></label>"+a[1]+"</br>"}var jumpserver={checked:!1,selected:{}};
jumpserver.language={processing:gettext("Loading ..."),search:gettext("Search"),select:{rows:{_:gettext("Selected item %d"),0:""}},lengthMenu:gettext("Per page _MENU_"),info:gettext("Displays the results of items _START_ to _END_; A total of _TOTAL_ entries"),infoFiltered:"",infoEmpty:"",zeroRecords:gettext("No match"),emptyTable:gettext("No record"),paginate:{first:"\u00ab",previous:"\u2039",next:"\u203a",last:"\u00bb"}};
jumpserver.initDataTable=function(a){var b=a.ele||$(".dataTable"),c=[{targets:0,orderable:!1,createdCell:function(a,b){$(a).html('<input type="checkbox" class="text-center ipt_check" id=99991937>'.replace("99991937",b))}},{className:"text-center",render:$.fn.dataTable.render.text(),targets:"_all"}];c=a.columnDefs?a.columnDefs.concat(c):c;var d={style:"multi",selector:"td:first-child"},e=b.DataTable({pageLength:a.pageLength||15,dom:a.dom||'<"#uc.pull-left">flt<"row m-t"<"col-md-8"<"#op.col-md-6"><"col-md-6 text-center"i>><"col-md-4"p>>',
order:a.order||[],buttons:[],columnDefs:c,ajax:{url:a.ajax_url,dataSrc:""},columns:a.columns||[],select:a.select||d,language:jumpserver.language,lengthMenu:[[10,15,25,50,-1],[10,15,25,50,"All"]]});e.on("select",function(a,b,c,d){a=e[c](d).nodes().to$();a.find("input.ipt_check").prop("checked",!0);jumpserver.selected[a.find("input.ipt_check").prop("id")]=!0}).on("deselect",function(a,b,c,d){a=e[c](d).nodes().to$();a.find("input.ipt_check").prop("checked",!1);jumpserver.selected[a.find("input.ipt_check").prop("id")]=
!1}).on("draw",function(){$("#op").html(a.op_html||"");$("#uc").html(a.uc_html||"");$('[data-toggle="popover"]').popover({html:!0,placement:"bottom",container:"body"})});$(".ipt_check_all").on("click",function(){$(this).prop("checked")?($(this).closest("table").find(".ipt_check").prop("checked",!0),jumpserver.checked=!0,e.rows({search:"applied",page:"current"}).select()):($(this).closest("table").find(".ipt_check").prop("checked",!1),jumpserver.checked=!1,e.rows({search:"applied",page:"current"}).deselect())});
return e};jumpserver.initStaticTable=function(a){$(a).DataTable({searching:!1,bInfo:!1,paging:!1,order:[],language:jumpserver.language})};
jumpserver.initServerSideDataTable=function(a){var b=a.ele||$(".dataTable"),c=[{targets:0,orderable:!1,createdCell:function(a,b){$(a).html('<input type="checkbox" class="text-center ipt_check" id=99991937>'.replace("99991937",b))}},{className:"text-center",targets:"_all"}];c=a.columnDefs?a.columnDefs.concat(c):c;var d={style:"multi",selector:"td:first-child"},e=b.DataTable({pageLength:a.pageLength||15,dom:a.dom||'<"#uc.pull-left">fltr<"row m-t"<"col-md-8"<"#op.col-md-6"><"col-md-6 text-center"i>><"col-md-4"p>>',
order:a.order||[],buttons:[],columnDefs:c,serverSide:!0,processing:!0,ajax:{url:a.ajax_url,data:function(b){delete b.columns;null!==b.length&&(b.limit=b.length,delete b.length);null!==b.start&&(b.offset=b.start,delete b.start);if(null!==b.search){var c={},e=[];b.search.value.split(" ").map(function(a,b){var d=a.split(":");2===d.length?c[d[0]]=d[1]:e.push(d)});b.search=e.join("");$.each(c,function(a,c){b[a]=c})}if(null!==b.order&&1===b.order.length){var d=a.columns[b.order[0].column].data;"desc"===
b.order[0].dir&&(d="-"+d);b.order=d}},dataFilter:function(a){a=jQuery.parseJSON(a);a.recordsTotal=a.count;a.recordsFiltered=a.count;return JSON.stringify(a)},dataSrc:"results"},columns:a.columns||[],select:a.select||d,language:jumpserver.language,lengthMenu:[[15,25,50,9999],[15,25,50,"All"]]});e.selected=[];e.selected_rows=[];e.on("select",function(a,b,c,d){a=e[c](d).nodes().to$();a.find("input.ipt_check").prop("checked",!0);jumpserver.selected[a.find("input.ipt_check").prop("id")]=!0;"row"===c&&
(c=e.rows(d).data(),$.each(c,function(a,b){e.selected_rows.push(b);b.id&&-1===$.inArray(b.id,e.selected)&&e.selected.push(b.id)}))}).on("deselect",function(a,b,c,d){a=e[c](d).nodes().to$();a.find("input.ipt_check").prop("checked",!1);jumpserver.selected[a.find("input.ipt_check").prop("id")]=!1;"row"===c&&(c=e.rows(d).data(),$.each(c,function(a,b){if(b.id){var c=e.selected.indexOf(b.id);-1<c&&e.selected.splice(c,1)}}))}).on("draw",function(){$("#op").html(a.op_html||"");$("#uc").html(a.uc_html||"");
var b=[];$.each(e.rows().data(),function(a,c){c.id&&b.push(c.id)});$.each(e.selected,function(a,c){var d=b.indexOf(c);-1<d&&e.rows(d).select()})});b=e.settings()[0].sTableId;$("#"+b+" .ipt_check_all").on("click",function(){$(this).prop("checked")?($(this).closest("table").find(".ipt_check").prop("checked",!0),e.rows({search:"applied",page:"current"}).select()):($(this).closest("table").find(".ipt_check").prop("checked",!1),e.rows({search:"applied",page:"current"}).deselect())});return e};
String.prototype.replaceAll=function(a,b){return this.replace(new RegExp(a,"gm"),b)};String.prototype.format=function(a){var b=this;if(1>arguments.length)return b;var c=arguments;1==arguments.length&&"object"==typeof a&&(c=a);for(var d in c){var e=c[d];void 0!=e&&(b=b.replaceAll("\\{"+d+"\\}",e))}return b};function setCookie(a,b){var c=new Date;c.setTime(c.getTime()+864E5);document.cookie=a+"="+b+";expires="+c.toUTCString()+";path=/"}
function delCookie(a){var b=new Date;b.setTime(b.getTime()-1);var c=getCookie(a);null!==c&&(document.cookie=a+"="+c+";expires"+b.toUTCString()+";path=/")}function createPopover(a,b,c){if(void 0!==c){var d=[];$.each(a,function(a,b){d.push(c(b))});a=d}return"<a data-toggle='popover' data-content='"+a.join("</br>")+"'>"+a.length+"</a>"}
$(function(){(function(a){a.getUrlParam=function(a){a=new RegExp("(^|&)"+a+"=([^&]*)(&|$)");a=window.location.search.substr(1).match(a);return null!=a?unescape(a[2]):null}})(jQuery)});function getUrlParam(a){a=new RegExp("(^|&)"+a+"=([^&]*)(&|$)");a=window.location.search.substr(1).match(a);return null!=a?unescape(a[2]):null}
function setUrlParam(a,b,c){var d=a.split("?");if(1===d.length)a+="?"+b+"="+c;else{a=d[1].split("&");var e={};$.each(a,function(a,b){var c=b.split("=");e[c[0]]=c[1]});e[b]=c;a=d[0]+"?";var f=[];$.each(e,function(a,b){f.push(a+"="+b)});a+=f.join("&")}return a}
var rules_short_map_id={min:"id_security_password_min_length",upper:"id_security_password_upper_case",lower:"id_security_password_lower_case",number:"id_security_password_number",special:"id_security_password_special_char"},rules_id_map_label={id_security_password_min_length:gettext("Password minimum length {N} bits"),id_security_password_upper_case:gettext("Must contain capital letters"),id_security_password_lower_case:gettext("Must contain lowercase letters"),id_security_password_number:gettext("Must contain numeric characters"),
id_security_password_special_char:gettext("Must contain special characters")};function getRuleLabel(a){return a.key===rules_short_map_id.min?rules_id_map_label[a.key].replace("{N}",a.value):rules_id_map_label[a.key]}
function checkPasswordRules(a,b){wordMinLength(a,b)?$("#"+rules_short_map_id.min).css("color","green"):$("#"+rules_short_map_id.min).css("color","#908a8a");wordUpperCase(a)?$("#"+rules_short_map_id.upper).css("color","green"):$("#"+rules_short_map_id.upper).css("color","#908a8a");wordLowerCase(a)?$("#"+rules_short_map_id.lower).css("color","green"):$("#"+rules_short_map_id.lower).css("color","#908a8a");wordNumber(a)?$("#"+rules_short_map_id.number).css("color","green"):$("#"+rules_short_map_id.number).css("color",
"#908a8a");wordSpecialChar(a)?$("#"+rules_short_map_id.special).css("color","green"):$("#"+rules_short_map_id.special).css("color","#908a8a")}function wordMinLength(a,b){return a.match(new RegExp("^(.{"+b+",})$"))}function wordUpperCase(a){return a.match(/([A-Z]+)/)}function wordLowerCase(a){return a.match(/([a-z]+)/)}function wordNumber(a){return a.match(/([\d]+)/)}function wordSpecialChar(a){return a.match(/[`,~,!,@,#,\$,%,\^,&,\*,\(,\),\-,_,=,\+,\{,\},\[,\],\|,\\,;,',:,",,,\.,<,>,\/,\?]+/)}
function popoverPasswordRules(a,b){var c="";jQuery.each(a,function(a,b){c+="<li id="+b.key+" style='list-style-type:none;'> <i class='fa fa-check-circle-o' style='margin-right:10px;' ></i>"+getRuleLabel(b)+"</li>"});b.html(c)}
function initPopover(a,b,c,d,e,f){options={};options.ui={container:a,viewports:{progress:b},showProgressbar:!0,showVerdictsInsideProgressBar:!0};options.i18n={fallback:f,t:function(a){var b=options.i18n.fallback[a];return b===a?"":b}};c.pwstrength(options);popoverPasswordRules(e,d)}
function initSelectedAssets2Table(){var a=$("#id_assets").val(),b=asset_table2.selected.concat();0!==b.length&&$.each(b,function(b,d){-1===$.inArray(d,a)&&$("#"+d).trigger("click")});null!==a&&(asset_table2.selected=a,$.each(a,function(a,b){var c=document.getElementById(b);if(null!==c)var d=c.parentElement.parentElement.className.indexOf("selected");-1===d&&$("#"+b).trigger("click")}))};